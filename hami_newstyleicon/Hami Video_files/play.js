function callSync(e,a,l){var r=null,n={url:e,async:!1,cache:!1,success:function(e){r=e}};return null==l?null!=a&&(n.data=a):(n.data=a,n.dataType=l),$.ajax(n),r}function callASync(e,a,l){var r={url:e,async:!0,cache:!1};null==l?null!=a&&(r.data=a):(r.data=a,r.dataType=l),$.ajax(r)}function clearCountdown(){try{null!=_countdown_tick&&clearTimeout(_countdown_tick)}catch(e){}}function claerPlayerSizeChange(){try{null!=_playerSizeChange_tick&&clearTimeout(_playerSizeChange_tick)}catch(e){}}function playerSizeChange(){claerPlayerSizeChange(),_playerSizeChange_tick=setTimeout(_playerSizeChange,200)}function _playerSizeChange(){var e=Math.round($("#player").width()/playerScale);$("#player").height(e),null!=myPlayer.video&&null!=myPlayer.video.player&&(myPlayer.video.player.style.height=e+"px")}function checkAgreement18(e){(agreement18=e)?($(".player_info1").remove(),$(".player_pic").remove(),$("#playerArea").hide(),openPlayer()):history.go(-1)}function openPlayer(e){if(null==e&&(4==myPlayer.rating||5==myPlayer.rating)&&!agreement18)return $(".player_pic").show(),$("#playerArea").show(),void $(".player_info1").show();startInitPlayer(),$("#player").html('<img src="'+myPlayer.contextPath+playerLoadingImg+'" style="max-width: 100%; max-height: 100%;"/>'),_playerSizeChange(),$(window).scroll();null==e?(myPlayer.preview=!1,now_contentId&&(myPlayer.contentID=now_contentId),$.getJSON(myPlayer.contextPath+"api/play.do",{id:myPlayer.contentID,tid:tid},function(e){if("play"==e.msg)myPlayer.preShow(null,e.url,e.ad,null);else if(0!=$(".video-js").length&&$(".video-js").hide(),"reinit"==e.msg)try{myPlayer.callInit()}catch(e){alert("callInit error:"+e),closePlayer()}else if("nolive"==e.msg)try{$("#player").html('<img src=http://chtvideo2.hinet.net/resources/images/none-liveshow.png height="100%;"/>'),_playerSizeChange(),$(window).scroll()}catch(e){alert("目前非直播時段!!"),closePlayer()}else if("login"==e.msg)try{myPlayer.callLogin(e.img)}catch(e){alert("請先登入會員!!"),closePlayer()}else if("buy"==e.msg)try{null!=e.salesplans&&e.salesplans.length>0?myPlayer.callBuy(e.salesplans):(alert("無銷售方案!!"),closePlayer())}catch(e){alert("callBuy error:"+e),closePlayer()}else alert(e.msg),closePlayer()}).fail(function(e,a,l){closePlayer()})):(myPlayer.preview=!0,myPlayer.preShow(null,e,{},null))}function playPreview(e){openPlayer(e)}function closePlayer(){stopApp(),myPlayer.setBookmark(),myPlayer.endPlayLog(),endInitPlayer()&&!myPlayer.isLive&&$("#player").empty(),location.hash="",$(window).scroll()}var playerScale=1.78,playerLoadingImg="resources/player/loading.png",myPlayer=myPlayer||{};myPlayer.init=function(e,a){function l(e){e||(e=0),null==y?$.ajax({type:"GET",url:myPlayer.url,error:function(e,a,l){switch(e.status){case 404:alert("The video url response:404"),null!=myPlayer.backUrl&&(location=myPlayer.backUrl);break;case 403:console.log(e);var r=e.responseText;r=(r=r.substring(r.indexOf("<hr><center>")+12)).substring(0,r.indexOf("</center>")),alert("The video url response:403("+r+")"),null!=myPlayer.backUrl&&(location=myPlayer.backUrl)}},success:function(a){o="auto",(y=new Array)[0]={src:myPlayer.url,type:"application/x-mpegURL",label:"auto",res:"auto"};var l=myPlayer.url.substring(0,myPlayer.url.indexOf("index.m3u8")),r=!1;a.indexOf("#EXT-X-VERSION:3")>-1&&(r=!0);for(var n=a.split("\n"),t=new Array,i=0,c=0;c<n.length;c++)-1==n[c].indexOf("#EXTM3U")&&-1==n[c].indexOf("#EXT-X-VERSION")&&""!=n[c]&&(t[i]=n[c],i++);if(t.length>2){for(c=0;c<t.length/2;c++){var s,m,u,P,d=t[2*c].split(",");r&&d[0].indexOf("BANDWIDTH")>-1?(P=d[0],s=d[1]):(P=d[1],s=d[4]),P=P.substring(P.indexOf("=")+1),5999==(P=Math.round(P/1e3))&&(P=6e3),m=(s=s.substring(s.indexOf("x")+1))+"p "+P+"kbps",u=l+t[2*c+1],y[c+1]={src:u,type:"application/x-mpegURL",label:m,res:s}}y.length>3&&(y[0]={src:y[y.length-2].src,type:"application/x-mpegURL",label:"auto",res:"auto"},o=y[y.length-3].res)}myPlayer.startPlay(e)}}):myPlayer.startPlay(e)}myPlayer.android=!1,myPlayer.android3=!1,myPlayer.preview=!1,myPlayer.contextPath=e,myPlayer.contentID=a,myPlayer.isLive=!1,myPlayer.rating=0,myPlayer.isAdult=!1,myPlayer.sendPlayerLog=null,myPlayer.realshow=!1,myPlayer.oldSecond=0,myPlayer.h5Player=null,myPlayer.backUrl=null,myPlayer.video=null,myPlayer.startime=null,myPlayer.playing=!1,myPlayer.bookmarkSecs=0,myPlayer.log=function(){try{console.log(arguments)}catch(e){}},myPlayer.callInit=function(){},myPlayer.callLogin=function(e){},myPlayer.callBuy=function(e){},myPlayer.sendPlayerTag=function(e){myPlayer.log("sendPlayerTag="+e),$("#playerTag").html('<img src="'+e+'"/>"')},myPlayer.endAD=function(){callASync(myPlayer.contextPath+"api/play_endAD.do?id="+myPlayer.contentID)},myPlayer.openPlayerKeyword=function(){},myPlayer.closePlayerKeyword=function(){},myPlayer.initPlayLog=function(){if(!0!==myPlayer.preview){var e=(new Date).getTime();if(myPlayer.startime=parseInt((e-e%1e3)/1e3,10),myPlayer.playing=!1,null!=myPlayer.sendPlayerLog){var a="initial";myPlayer.isLive?a+="channel":a+="vod",myPlayer.sendPlayerLog(a)}}},myPlayer.playPlayLog=function(){if(null!=myPlayer.startime&&!0!==myPlayer.preview&&!myPlayer.playing&&(myPlayer.playing=!0,null!=myPlayer.sendPlayerLog)){var e="play";myPlayer.isLive?e+="channel":e+="vod",myPlayer.sendPlayerLog(e)}},myPlayer.pausePlayLog=function(){if(null!=myPlayer.startime&&!0!==myPlayer.preview&&(myPlayer.playing=!1,null!=myPlayer.sendPlayerLog)){var e="pause";myPlayer.isLive?e+="channel":e+="vod",myPlayer.sendPlayerLog(e)}},myPlayer.endPlayLog=function(){if(null!=myPlayer.startime&&!0!==myPlayer.preview){myPlayer.playing=!1;var e=myPlayer.startime;if(myPlayer.startime=null,null!=myPlayer.sendPlayerLog){var a,l="end";myPlayer.isLive?(l+="channel",a="channel"):(l+="vod",a="vod"),a+="session&watchtime="+e,myPlayer.sendPlayerLog(l),myPlayer.sendPlayerLog(a),callASync(myPlayer.contextPath+"api/endPlay.do?id="+myPlayer.contentID)}else callASync(myPlayer.contextPath+"api/endPlay.do?id="+myPlayer.contentID)}},myPlayer.preShow=function(e,a,r,n){y=null,myPlayer.url=a;if(myPlayer.play=function(e,a){if(!0!==a&&0==e&&!0!==myPlayer.preview&&myPlayer.rating>1){var r={resourcesPath:myPlayer.contextPath+"resources/",rating:myPlayer.rating,bookmarkSecs:e,countdown:3};$.get(r.resourcesPath+"player/vodCountdown.html",function(a){var n=$.templates(a).render(r);$("#player").html(n);var y=r.countdown,t=function(){y--,$("#countdown").html(y),0==y?(l(e),_countdown_tick=null):_countdown_tick=setTimeout(t,1e3)};_countdown_tick=setTimeout(t,1e3)}).fail(function(){l(e)})}else l(e)},!myPlayer.isLive&&"undefined"!=typeof playType&&"trailer"!=playType){var t=callSync(myPlayer.contextPath+"api/getPlayerBookmark.do?id="+myPlayer.contentID,"json");if(null!=t)try{var o=parseInt(t.seconds,10);if(!isNaN(o)&&o>0){if(myPlayer.cast.casting)myPlayer.play(o,!0);else{var i=Math.floor(o/3600),c=Math.floor(o%3600/60),s=Math.floor(o%3600%60),m=(i>0?i+":":"")+(c>0?(i>0&&c<10?"0":"")+c+":":"0:")+(s<10?"0":"")+s,u={resourcesPath:myPlayer.contextPath+"resources/",bookmarkSecs:o,bookmarkTime:m,countdown:8};$.get(u.resourcesPath+"player/countdown.html",function(e){var a=$.templates(e).render(u),l=u.countdown;$("#player").html(a);var r=function(){l--,$("#countdown").html(l),0==l?(myPlayer.play(o),_countdown_tick=null):_countdown_tick=setTimeout(r,1e3)};_countdown_tick=setTimeout(r,1e3)}).fail(function(){myPlayer.play(o)})}return}}catch(e){alert(e)}}myPlayer.play(0,myPlayer.cast.casting)};var r=!1,n=null,y=null,t=5,o=null,i=!0,c=!0,s=!0;myPlayer.startPlay=function(e){var a=$("#player").width(),l="";myPlayer.isLive&&(l="style='object-fit:fill'");var m=Math.round(a/playerScale),u="";isIE&&(u=',"techOrder":["flash","html5"]');var P="<video id='h5video' class='video-js advjs-default-skin advjs-big-play-centered' "+l+" width='"+a+"' height='"+m+'\' data-setup=\'{"controls":true,"autoplay":true,"preload":"auto"'+u+"}'><source id='h5source' src='"+myPlayer.url+"' type='application/x-mpegURL'></source></video>";$("#player").html(P),null!=myPlayer.h5Player&&myPlayer.h5Player.dispose(),1==y.length?(console.log("play one resolution"),myPlayer.h5Player=videojs("h5video")):(console.log("play multi resolution"),myPlayer.h5Player=videojs("h5video",{controls:!0,plugins:{videoJsResolutionSwitcher:{default:o,dynamicLabel:!1}}},function(){n=this,window.player=n,n.updateSrc(y),n.on("resolutionchange",function(){})})),myPlayer.oldSecond=e,myPlayer.h5Player.on("loadeddata",function(){myPlayer.h5Player.currentTime(myPlayer.oldSecond)}),myPlayer.h5Player.on("timeupdate",function(){var e=parseInt(myPlayer.h5Player.currentTime(),10);myPlayer.oldSecond!=e&&e-myPlayer.oldSecond>=180&&(myPlayer.oldSecond=e,myPlayer.setBookmark())}),myPlayer.h5Player.on("pause",function(){var e=parseInt(myPlayer.h5Player.currentTime(),10);myPlayer.oldSecond=e,myPlayer.setBookmark(),s=!1}),myPlayer.h5Player.on("play",function(){s=!0});var d=document.getElementById("h5video_html5_api");if(null!=d){d.oncanplay=function(){r=!0,myPlayer.cast.casting&&syncLocalPlayer()},d.onprogress=function(){var e=myPlayer.h5Player.tech({IWillNotUseThisInPlugins:!0}).hls;try{var a=(e.bandwidth/1024).toFixed(1),l=(a/1024).toFixed(1)+" Mbps",r=document.getElementById("videoKbps");if(r?r.innerHTML=l:$(".vjs-resolution-button").before('<div id="videoKbps" style="padding-top:12px;">'+l+"</div>"),c&&s){if(i=!0,10==t){if(i=!1,"auto"!=n.currentResolution().label)try{console.log("check video speed"),a=parseInt(a);for(var o=n.currentResolution().label,m=0;m<y.length;m++){var u=y[m].label;if("auto"!=u){if(!(a>parseInt(u.substring(u.indexOf(" ")+1,u.indexOf("kbps")))))break;o=u}}n.currentResolution().label!=o&&(console.log(n.currentResolution().label+" change to "+o),n.currentResolution(o),c=!1)}catch(e){}}else i=!0;t>=10&&(t=0),t++}}catch(e){console.log(e)}},d.addEventListener("error",function(e){switch(console.log("errorCode:"+e.target.error.code),r=!1,e.target.error.code){case e.target.error.MEDIA_ERR_ABORTED:alert("You aborted the video playback.");break;case e.target.error.MEDIA_ERR_NETWORK:myPlayer.reLoadH5V();break;case e.target.error.MEDIA_ERR_DECODE:alert("The video playback was aborted due to a corruption problem or because the video used features your browser did not support.");break;case e.target.error.MEDIA_ERR_SRC_NOT_SUPPORTED:alert("The video could not be loaded, either because the server or network failed or because the format is not supported.");break;default:alert("An unknown error occurred.")}}),d.onvolumechange=function(){$.cookie("video_volume",d.volume,{path:"/",expires:365}),$.cookie("video_muted",d.muted,{path:"/",expires:365})};try{d.volume=$.cookie("video_volume")}catch(e){$.cookie("video_volume",d.volume,{path:"/",expires:365})}try{"true"==$.cookie("video_muted")&&(d.muted=!0)}catch(e){$.cookie("video_muted",!1,{path:"/",expires:365})}}},myPlayer.reLoadH5V=function(){console.log("media_err_network"),document.getElementById("h5video_html5_api").load(),l()},myPlayer.setBookmark=function(){if(!myPlayer.isLive&&!0!==myPlayer.preview)try{var e=myPlayer.h5Player.currentTime(),a=parseInt(e,10);!isNaN(a)&&a>0&&callASync(myPlayer.contextPath+"api/setPlayerBookmark.do?id="+myPlayer.contentID+"&seconds="+a)}catch(e){}}};var _countdown_tick=null,_playerSizeChange_tick=null;$(window).resize(playerSizeChange).on("orientationchange",playerSizeChange),$(window).unload(function(){$.isFunction(myPlayer.setBookmark)&&myPlayer.setBookmark(),$.isFunction(myPlayer.endPlayLog)&&myPlayer.endPlayLog(),claerPlayerSizeChange(),clearCountdown()});var agreement18=!1;